<?xml version="1.0" ?>
  <powerstream
    unix_run_path="%%runpath"
    win_run_path="%%runpath2"
  >
    <!-- Generated by AppbuilderWeb -->
    <project
      name="Waste Mgmt Overfill Letter"
      client="Waste Management"
      client_code="wmi"
      location="lgn"
      location_code="403"
      programmer="CAR"
      programmer_email="cade.a.rasmussen\\\@rrd.com"
      programmer_name="Cade Rasmussen"
      project="Overfill"
      project_code="over"
      project_id="%%projectID"
      project_manager="LRO"
      project_manager_email="Linden.olson\\\@rrd.com"
      project_manager_name="Linden Olson"
      other_emails="AuditsProdMngt\\\@rrd.com,BCSReportingTeam\\\@rrd.com"
      sales_code="%%sales"
      disable="n"
    />
    <processes
      ver="%%ver"
      asite="lgn"
      csite="lgn"
      genlib="/apps/powerstream/gen$levels$tver/"
      msite="lgn"
      psite="lgn"
      sbu="fin"
      site="lgn"
      T1_adf_type="none"
      adf_type="mrdf"
	  jobtype="distribution"
	  T1_jobtype="normal"
      arch="3"
      arcrep="30;$runpath$site$lvl.$sbu.$pi$n.$pjt.repext*,${runpath}batinf.txt,$runpath$site$lvl.$sbu.$pi$n.$pjt.inimg*,${runpath}*.objects.arr,${runpath}*.pages.arr"
      arcrep_days="30"
      brk_type="documents"
      chunk_qty="5000"
      email_error="y"
      emlto_error="\$project_manager_email,\$programmer_email,\$other_emails, kent.le\\\@rrd.com"
      ffile="$site$lvl.$sbu.$pi$n.$pjt"
      gencopys="${genlib}copy/"
      genfreefonts="${genlib}resource/fonts/free_fonts/"
      genloads="${genlib}load/"
      genparms="${genlib}parm/"
      genperls="${genlib}perl/"
      genscripts="${genlib}perl/"
      genskels="${genlib}skel/"
      household="y"
      jobcond="4"
      mclass="1"
      mdate="00000000"
      permt="489"
      pjtpath="/bcs/$psite$lvlc/clientapp/$pi$pjt/"
	  mrdfpath="/bcs/$psite$lvlc/input/" 	
      printer="pro"
      reset_files="n"
      reset_qual_info="n"
      rundir="$pi${n}_$c"
      runpath="/bcs/$psite$lvl/clientapp/$pi$pjt/run/$rundir/"
      usrarcs="/bcs/$psite$lvlc/archive/"
      usrinputs="${pjtpath}input/"
      usrloads="${pjtpath}load/"
      usrparms="${pjtpath}parm/"
      usrresources="${pjtpath}parm/"
      usrruns="${pjtpath}run/"
      usrscripts="${pjtpath}scripts/"
      usrskels="${pjtpath}skel/"
    >
      <defaults
        lvl="t"
        lvlc="t"
        lvls="p"
        auto_order_number="y"
        c="01"
        copy_base="$c"
        epcsnd="y"
        get_day="none"
        T1_infile="/bcs/lgn$lvl/clientapp/$pi$pjt/input/LGN$LVL.SMR.CAM0000.LTRS.INPUT01.*.pdf"
        T2_infile="/bcs/lgn$lvl/clientapp/$pi$pjt/input/LGN$LVL.SMR.CAM0000.LTRS.INPUT*.*.pdf"
        infile="/bcs/lgn$lvl/clientapp/$pi$pjt/input/*.zip"
        infilemask="*.zip"
        inreprint="/bcs/lgn$lvl/input/$reprint"
        jobid="00"
        n="9999"
        orderNumberSave="y"
        projectID="816311009403"
        q_freq="500"
        reprint="$FFILE.MISS${JOBID}V$v"
        sales="8163"
        sr="$sales"
        _ver="04r20a"
        ver="04r21a"
        gsvers="/apps/ghostscript_9.25/bin/gs"
        ptkversion="/apps/pdftk_2.01/bin/pdftk"
        disable="n"
      />
      <process
        name="full_process"
        disable="n" >


       <command step_name="Check_for_input_files">
	    <![CDATA[ 
            my @InputFiles = glob("${usrinputs}*.zip");
            my $input_count= scalar @InputFiles;
            print("There are ${input_count} input files today.\n");

            $no_input_files = 0;
            if ($input_count == 0){
                $no_input_files = 1;
            } 
      	    ]]>
      </command>	

      <if name="if_no_files" >
				<condition name="no_files" >
					<![CDATA[ ($no_input_files == 1)]]>

          <module
            stepname="geneml01"
            modname="geneml01"
            emlto="\$project_manager_email,\$programmer_email,WM_OVERFILLED_INTERNAL\\\@rrd.com,WM_OVERFILLED_EXTERNAL\\\@rrd.com"
            emltto="\$programmer_email"
            emlfr="\$programmer_email"
            emlsub="WMIOVER - ${n} - $date2 - No Input Files"
            emlbody="No input files were provided by 3:00PM Central Time. \n Program will sweep all inputs on the next business day.\n"
            emlatt=""
            disable="n"
          />

          <module
            name="auto_order_update"
            modname="genoup01"
            disable="n"
          />

          <module
            stepname="gendie01"
            modname="gendie01"
            dierc="0"
            diemsg="No files. Die nicely"
            disable="n"
          />
          
          
				</condition>
			 </if>
       
      <module
        name="pre_setup_prod"
        modname="genpre01"
        precpy="n"
        preorg="y"
        disable="t"/>
      <module
        name="pre_setup_test"
        modname="genpre01"
        precpy="n"
        preorg="y"
        disable="pr" />
      <module
          name="auto_order_update"
          modname="genoup01"
          disable="n"/>
		
	  <command step_name="make_directories">
	    <![CDATA[ 
  	    $respath = "${runpath}resource/";
        $pdfpath = "${runpath}pdfs/";
	    `rm -r $respath`;
	    `mkdir $respath`;
      `rm -r $pdfpath`;
	    `mkdir $pdfpath`;
	    `chmod 0777 $respath`;
      `chmod 0777 $pdfpath`;
		print "MakeDir: $respath  \n";
    print "MakeDir: $pdfpath  \n";
	    ]]>
      </command>	
<!--  Copy in TEST mode -->			  
	  <module
		stepname="gencpy01_wildcard"
		modname="gencpy01"
		cpyinp="${usrinputs}${infilemask}"
		T1_cpyinp="${usrinputs}LGN$LVL.SMR.CAM0000.LTRS.INPUT*.*.zip"
		cpyout="${respath}"
		disable="pr" />
<!--  Move in PROD mode -->			  	  
	  <module name="move_file"
        modname="genmov01"
        movinp="${usrinputs}${infilemask}"
        T1_movinp="${usrinputs}LGN$LVL.SMR.CAM0000.LTRS.INPUT*.*.zip"
	    movout="${respath}"
        id="32"
        memo=""
        disable="t" />		  
      <loop name="loop_input"
              loop_dir="$respath"
              loop_filemask="${infilemask}"
              T1_loop_filemask="LGN$LVL.SMR.CAM0000.LTRS.INPUT*.*.zip"
			  T1_infile="$loop_curfile"
              disable="n">			  
			<module
				stepname="gencpy01_wildcard"
				modname="gencpy01"
				cpyinp="${runpath}$loop_curfile"
				cpyout="${respath}"
				disable="y"/>	
			<module
				name="dupcheck_$loop_counter2"
				modname="gendup01"
				dupact="2"
				dupfr="\$project_manager_email"
				T1_dupmask1="$inwork"
				dupmask1="$loop_curfile"
				dupto="\$project_manager_email,\$programmer_email,WM_OVERFILLED_INTERNAL\\\@rrd.com,\$other_emails"
				duptto="\$programmer_email"
				disable="tr"/>

       <!-- Extract pdfs from input zip -->
            <command step_name="extract_pdfs">
                <![CDATA[ 	 
                `unzip ${respath}$loop_curfile -x "__MACOSX/*" -x "Client\*" -d $pdfpath`;
                print "Extract pdfs for : ${respath}$loop_curfile  \n";
                ]]>
            </command>
			<!-- Extract recon XML from input zip -->
            <command step_name="make_directories">
                <![CDATA[ 	 
                `unzip -j ${respath}$loop_curfile '*.xml' -x "__MACOSX/*"`;
                print "ExtractXML: ${respath}$loop_curfile  \n";
                ]]>
            </command>
      
      </loop>		
      <module
        stepname="gencat01"
        modname="gencat01"
        catinp="${runpath}*.xml"
        catout="${runpath}Client_recon_combined.xml"
        disable="n"
      />
      
			<!-- Add Solimar ZIP to PDF step -->
        	<module
        		name="remote_solimar_concat"
        		modname="gensolcat01"
        		T1_solcat_in="${runpath}solimar_input.zip"
        		solcat_in="${pdfpath}*.pdf"
        		solcat_out_pdf="$pre.solimar_concat.pdf"
            solcat_out_txt="solcat_out_txt${c}.txt"
        		watmax="36000"
            _watfound="300"
        		watfound="60"
        		watbuild="10"
        		disable="n" />
			<!-- Add PDF NORMALIZE step -->
			<module name="pdf_normalizer"
				modname="pdf_norm_parbatch"
				pdfnorm_overwrite="y"
				pdfnorm_filemask="$loop_curfile"
				pdfnorm_path="${respath}"
				pdfnorm_type="gs"
				pdfnorm_fnt="/usr/share/ghostscript/fonts"		  
				gsvers="/apps/ghostscript_9.25/bin/gs"
				pdfnorm_wait="36000"
				T1_pdfnorm_var="-q -dSAFER -dNOPAUSE -dBATCH -dAutoRotatePages=/None -dSubsetFonts=true -dEmbedAllFonts=true"
				T2_pdfnorm_var="-q -dSAFER -dNOPAUSE -dBATCH -dAutoRotatePages=/None -dPrinted=false -dSubsetFonts=false"
				disable="y"
			/>			
	  <command>
			<![CDATA[
			$FileName="$loop_curfile";
			#$FileNameSub=~s/(.*).zip/$1/;				
			print "InfileName   = $FileName \n";
			`cd $respath;find . -type f > ${runpath}input_listing.txt`;
			#`find $respath -type d > ${runpath}input_listing.txt`;
			`grep "./" ${runpath}input_listing.txt |cut -c 3-42  > ${runpath}dir_list.txt`;
			#`ls > ${runpath}input_listing.txt`;
			print "STOP AND LOOK: $FileName \n";
			#<STDIN>;
			]]> 
	  </command>	
			<subprocess
				name="pre_process_01"
				input="01"
				processname="pre_process"
				disable="n"/>


<!-- ADD a step - check if error report is NOT empty, email it  -->	
		<module
			stepname="genemp01"
			modname="genemp01"
			empinp="$pre.xml.report.txt"
		/>	
		<if name="if_errorrpt_check" >
		  <condition name="condition_error" >
		    <![CDATA[ ($emprc == 0) ]]>
			<module
              name="xml_report_error_found"
              modname="geneml01"
              emlatt="$pre.xml.report.txt"
              emlfr="\$project_manager_email"
              emlsub="$PI Order: Error Reporting"
              emlto="\$project_manager_email,\$programmer_email,WM_OVERFILLED_INTERNAL\\\@rrd.com,\$other_emails"
              emltto="\$programmer_email"
              disable="n"
			/> 

		  </condition>
		</if> 
 
	  
	  <command disable="n">
		<![CDATA[
		print "PAUSE2: $lastpost  \n" ;
		#<STDIN>;
		#.extrac.updt	 
		]]> 
	  </command>	
		
      <module
          name="reconciliation_pre_$loop_counter2"
          modname="genrcn01"
          emlbhtm="wrap"
          rcnbatt="$pre.rcnrpt$post"
          rcncc1f="\$programmer_email"
          rcnele="pre_recon"
          rcneml="y"
		  T1_rcnsub="Pre Reconciliation Report: WasteMgmt Overfill WMI OVER $n"
          rcnfr="\$project_manager_email"
		  rcnin0="${runpath}Client_recon_combined.xml"		  
      rcnin1="$pre.extrcn.combined"
      rcnin2="$pre.subtracted_records"
      
          T1_rcnin9="$pre.client.counts"
          rcnto="\$project_manager_email,\$programmer_email,WM_OVERFILLED_INTERNAL\\\@rrd.com,WM_OVERFILLED_EXTERNAL\\\@rrd.com,\$other_emails"
          rcntto="\$project_manager_email,\$programmer_email"
		  T1_rcncc1s="client\\\@rrd.com"
          rcntyp="pre"
          disable="n" />		  
		  
        <subprocess
          name="mid_process"
          processname="mid_process"
          disable="n"
        />
        <loop
          name="loop_post_process"
          loop_inc="1"
          loop_start="1"
          loop_end="1"		  
          disable="n" >
          <if  name="if_for_loop_post_process" >
            <condition
              name="condition_for_loop_post_process_1" >
              <![CDATA[ ($loop_counter==1) ]]>
              <assign
                name="assign_post_process_loop_1"
                c="01"
                msize="l"
                msort="y"
				jobtype="distribution"
				T1_jobtype="normal"
                T1_outmask="pdnoxxxx.c${c}xx.cr"
                outmask="pdnoxxxx.c${c}xx.cr$\0001"
                post="$c"
                postfile="${runpath}c${c}_batout.txt"
                recon_step_name="OUTPUT${c}_$batch"
                disable="n" />
            </condition>
          </if>	  
          <module
            name="post_process_check_$loop_counter2"
            modname="genemp01"
            empinp="$postfile"
            disable="n" />
          <if  name="if_post_process_empty_check_$loop_counter2" >
            <condition
              name="condition_post_process_empty_check_$loop_counter2" >
              <![CDATA[ ($emprc == 0) ]]>
              <subprocess
                name="post_process_$loop_counter2"
                processname="post_process"
                disable="n"/>
				<subprocess name="label_process" disable="n"
				processname="label_process"/>					
            </condition>
            <else  name="else_post_process_empty_check_$loop_counter2" >
              <module
                name="empty_file_for_$loop_counter2"
                modname="genemf01"
                emfbat="$batchid"
                emfdesc="$RECON_STEP_NAME"
                emfeml="n"
                emffrp="n"
                emftyp="copy"
                disable="n" />
            </else>
          </if>		  
        </loop>
        <subprocess
          name="final_process"
          processname="final_process"
          disable="n" />
      </process>
      <process
        name="pre_process"
        disable="n"  >
			<command><!--
DALT.FIN.BOA0000.DODD.INPUT01.221013  -->			
				<![CDATA[
				#$inpt = substr($loop_curfile, 22, 2);
				$inpt = substr($Fileid, 27, 2);
				print "INPUT NUMBER: $inpt" ;
				#$post = $inpt;
				]]> 
			</command>	
			<module
				name="extract_$post"
				modname="genext01"
				reset_extract_files="y"				
				RECON_STEP_NAME="INPUT_$inpt"
				extinp="$pre.solimar_concat.pdf"
				extsto="$extinp"
				extrac="$pre.extrac$post"
				extrcn="$pre.extrcn$post"
				disable="n"
				
			/>

      <module
        stepname="gencpy01"
        modname="gencpy01"
        cpyinp="$pre.extrac$post"
        cpyout="$pre.extrac_original_with_MA$post"
        disable="n"
      />

      <command>
      <!-- suppression of certain address -->
				<![CDATA[
				open(ofh, ">$pre.extrac$post");
        open(extract_file_handle,"<$pre.extrac_original_with_MA$post");
        open(excluded_address_FH, ">$pre.excluded_records.txt");

        @all_extract_lines = <extract_file_handle>;
        $extract_size = @all_extract_lines;

        $suppressed_records_counter = 0;
        for($i = 0; $i < @all_extract_lines; $i++) {
          
          $address_to_ignore = "POBOX589WINDSOR,CT,06095-0589";
          
          # grabbing po box and city state zip fields from extract
          $extract_address = substr(@all_extract_lines[$i],712,100);                      #pos 712 for 100 bytes

          # assuring address is all uppercase
          $extract_address = uc($extract_address);
          
          # removing periods and spaces
          $extract_address =~ s/(\.|\ )//g;
          
          $new_line = @all_extract_lines[$i];
          if ($extract_address eq $address_to_ignore){
            print("LOG: NOMAIL - ${extract_address}\n");
            $suppressed_records_counter +=1;
            print excluded_address_FH $new_line;
          }
          else{
            print ofh $new_line;
          }
          
        }
        close(extract_file_handle);
        close(ofh);
        close(excluded_address_FH);
        
        my $suppressed_documents = $suppressed_records_counter;
        my $suppressed_sheets = $suppressed_documents;
        my $suppressed_pages = 2*$suppressed_sheets;
        open(subtracted_record_FH, ">$pre.subtracted_records");
        print subtracted_record_FH "<SUBTRACT DESCRIPTION=\"Suppressed Addresses\" DOCUMENTS=\"$suppressed_documents\" SHEETS=\"$suppressed_sheets\" PAGES=\"$suppressed_pages\"/>\n";
        close(subtracted_record_FH);
        


				]]> 
			</command>	

<module
        stepname="gencpy01"
        modname="gencpy01"
        cpyinp="$pre.extrac$post"
        cpyout="$pre.extrac_original2$post"
        disable="n"
      />
<!-- Check if HHD Key has "Account: " if yes, grab text after Account:(), if no, set entire field as blank -->
<command>
				<![CDATA[
				open(ofh, ">$pre.extrac$post");
        print("TEST\n");
        open(extract_file_handle,"<$pre.extrac_original2$post");
        
        
        @all_extract_lines = <extract_file_handle>;
        
        for($i = 0; $i < @all_extract_lines; $i++) {
          my $new_key = "";
          my $hhd_key = substr(@all_extract_lines[$i], 1381, 50);
          print("hhd_key = ${hhd_key}\n");
          if ($hhd_key =~ /Account:/){
            print("Found ACCOUNT\n");
            if ($hhd_key =~ /Account:(.*)/){
                $new_key = sprintf "%-50s", $1;
            }
            else{
              die "Error in extract hhd script";
            }
            
          }
          else{
            $new_key = sprintf "%-50s", " ";
          }
          $new_line = @all_extract_lines[$i];
          substr($new_line,1381,50,$new_key);
          print ofh $new_line;
        }

        close(extract_file_handle);
        close(ofh);

          
        ]]> 
			</command>
   
      
<!-- ADD a CAT step for EXTRAC.COMBINED  RCNIN.COMBINED-->
			<module
				stepname="gencat01"
				modname="gencat01"
				_catinp="$extrcn"
				catinp="$pre.extrcn$post"
				catout="$pre.extrcn.combined"/>	  
			<module
				stepname="gencat01"
				modname="gencat01"
				catinp="$pre.extrac$post"
				   T1_catinp="$pre.extrac${loop_counter2}.mod"				
				catout="$pre.extrac.combined"
				disable="n"/>	
		
<!-- NOW add MATCH script to read SUPPLEMENT FILE and move ADDRESS fields into EXTRACT -->		
<!--  Copy in TEST mode -->			  
	  <module
		stepname="gencpy01_wildcard"
		modname="gencpy01"
		cpyinp="${usrinputs}supplemental_file.csv"
		cpyout="${runpath}"
		disable="y" />
<!--  Move in PROD mode -->			  	  
	  <module name="move_file"
        modname="genmov01"
        movinp="${usrinputs}supplemental_file.csv"
	    movout="${runpath}"
        id="32"
        memo=""
        disable="y" />
			<system name="pre_process_audit"
				command="perl ${usrscripts}supplemental_matchup.pl ${runpath}supplemental_file.csv $pre.extrac.combined $pre $n"
				system_variable="except_flag"
		        disable="y"/>			
			<command name="Supplemental Matchup"
				     disable="y">
				<![CDATA[
					print "STOP AND LOOK:  $ffile.extrac.updt \n" ;
					#<STDIN>;
				]]> 
			</command>			
		
			<command disable="y">
				<![CDATA[
			    $lastpost="$loop_counter2";
				print "PAUSE2loop:  $lastpost \n" ;
				#<STDIN>;
				]]> 
			</command>	

      </process>
      <process
        name="mid_process"
        disable="n" >
      <module
        stepname="genhhd01"
        modname="genhhd01"
        hhdinp="$pre.extrac.combined"
        hhdcriteria="key"
        hhdele="householding"
        hhdbuild="n"
      />		 
        <module
          name="batching"
          modname="genbat01"
          batequ="y"
          batinp="$hhdext"
		  Tx_batinp="$pre.mail.zips" 
          batopt="y"
          optimize_insert_plans="y"
          disable="n"  />
      </process>
      <process
        name="post_process"
        reset_files="y"
        disable="n"  >
        <if
          name="if_mailsort_yes_$batchid$c"
          disable="n"    >
          <condition
            name="condition_mailsort_yes_$batchid$c"
            disable="n"   >
            <![CDATA[ ($msort eq "y") ]]>
            <module
              name="mailsort_$batchid$c"
              modname="genmst07"
              comment_l1="______________"
              comment_l2="______________"
              msacsw="y"
              mscpi="n"
              msembsw="n"
              msflgsw="n"
              msimasc=""
              msimasc2=""
              msimbii="n"
              msimfcd="f"
              msimfsd="y"
              msimfun="p"
              msimmid="898567"
              msimmln="6"
              T1_msimocri="2956363"
              msimomid="898567"
              msimomil="6"
              msimopt="2"
              msimpmid="106952"
              msimpcri="2815320"
              msimpmil="6"
              msimpop="b"
              msimsln="6"
              msimspn=""
              msimssw="a"
              msimstc="036"
              msimstc2="700"
              msinssw="n"
              msmeter="n"
              mspni="y"
			  msmum="5"
			  msmud="07/23/2016"
              mstatr="${runpath}batat$msize.txt"
              mstinp="$postfile"
			  mdmfcr="YearEnd"
              mszp4bc="I"
              release="$lvl"
              disable="n"
            />
            <module
              name="msort_cat_$batchid$c"
              modname="gencat01"
              catapp="n"
              catinp="$pre.msort$post,$pre.foregn$post,$pre.specal$post,$pre.nomail$post,"
              catout="$pre.catout$post"
              disable="n" />
            <subprocess
              name="print_msort_reports_$batchid$c"
              processname="msort_reports_process"
              disable="n" />
          </condition>
          <else>
            <module
              name="non_msort_move_$batchid$c"
              modname="genmov01"
              movinp="$postfile"
              movout="$pre.catout$post"
              disable="n"     />
          </else>
        </if>
        <assign
          name="assign_test_qrecs_values_$batchid$c"
          qrecs="10"
          disable="t"  />
        <assign
          name="assign_prod_qrecs_values_$batchid$c"
          qrecs="1"
          disable="p" />
        <module
          name="flag_proofs_$batchid$c"
          modname="gensrt01"
          srtele="flag_proofs"
          srtinp="$pre.catout$post"
          srtout="$pre.prfout$post"
          disable="n"  />
        <module
          name="merge_$batchid$c"
          modname="genmrg01"
          adf_type="mrdf"
          T1_adf_type="none"
          compression_level="5"
          crfsnd="y"
          epcsnd="y"
          merge_type="print"
          mrgbat="${runpath}batinf.txt"
          mrgext="$pre.prfout$post"
          mrgimg="$pre.inimg$copy_base"
          mrgrsc="${genparms}pdf.pdf"
          mrghhd="$hhdimf"
          T1_mrghhd="$prev.hhdimf$post"
		  T1_mrgcrt="$pre.$outmask$\0001"
          reset_qual_info="n"
          mrgps="d" 		  
          disable="n" />
		
         <system name="copy_printfile_to_pdf" disable="y"
            command="for file in *xx.cr??; do `echo \\\$file`; file2=`echo \\\$file | sed 's/psnoxxxx./proof./'`; cp \\\$file \\\$file2.pdf;done"/>

        <module
          name="generate_pdf_proof_file_$batchid$c"
          modname="genpdx01"
          pdxcombo="y"
          pdxidx="$pre.repext$post"
          pdxout="$pre.psnoxxxx.c${c}xx.cr00"
          pdxproofs="y"
          pdxtyp="pdf"
          pdxzip="n"
          disable="y"
        />
		<loop 	name="crite_1oop" 
				loop_data_file="$pre.outlst$post" 
				T1_loop_max_process="4" 
				loop_process_save_log="n" 
				disable="y">		
			<module
				stepname="gencpy01_wildcard"
				modname="gencpy01"
				cpyinp="${runpath}${loop_curline}"
				cpyout="${runpath}crite${loop_counter2}.pdf"
				disable="n" />				
			<module
				name="add_tray_call"
				modname="genatj01"
				T1_atjinp="$pre.${outmask}*"
				atjinp="${runpath}${loop_curline}"
				atjjog="n"
				pdpver="/apps/xpdf_3.03/bin/"
				duplex="y"
				disable="y"	/>		
			<module
				 name="add_tray_call"
				 modname="genatj01"
                 atjinp="${runpath}${loop_curline}"
                 atjjog="n"
                 atjcon="sol"
                 duplex="y"
                 atjsoldrop="pdpsnxxx"
                 disable="n"     />				
				
		</loop>
    <loop name="reorder_pages" loop_data_file="$mrglst" disable="n">
                    <module
                      name="reorder_pages"
                      modname="genreo01"
                      reoinp="$runpath$loop_curline"
                      reotyp="r"
                      reover="2"
                      disable="n"
                    />
                </loop>
        <module
          name="tapeless_$batchid$c"
          modname="gentpl01"
          tpllst="$pre.outlst$post"
          tplpri="pro"
          tplmov="n"
          disable="n"
        />
        <module
          name="email_outfrp_$batchid$c"
          modname="geneml01"
          emlbatt="$pre.outfrp$post"
          emlbody="See attached report"
          emlfr="\$project_manager_email"
          emlsub="$PI Order: $n Copy: $c File: $infile Completed"
          emlto="\$project_manager_email,\$programmer_email,WM_OVERFILLED_INTERNAL\\\@rrd.com,\$other_emails"
          emltto="\$programmer_email"
          disable="n"
        />
        <subprocess
          name="print_reports_$batchid$c"
          processname="print_reports_process"
          disable="n"
        />
      </process>
      <process
        name="print_reports_process"
        disable="n"
      >
        <module
          name="concatenate_outfrp_reports_$batchid$c"
          modname="gencat01"
          catapp="n"
		  comment="Reduce to a single copy, per Master Gibblets"
          T1_catinp="$pre.outfrp$post,$pre.outfrp$post,$pre.outfrp$post,$pre.outplg$post,$pre.outppr$post,$runpath$PI$n$run$c$BATCH$PJT${SBU}_prpt.txt"
          catinp="$pre.outfrp$post,$pre.outplg$post,$pre.outppr$post,$runpath$PI$n$run$c$BATCH$PJT${SBU}_prpt.txt"
          catout="$pre.prod$post.reports.txt"
          pre="$runpath$site$lvl.$sbu.$pi$n.$pjt"
          runpath="/bcs/$psite$lvl/clientapp/$pi$pjt/run/$rundir/"
          disable="n"
        />
        <module
          name="print_print_reports_$batchid$c"
          modname="genprr01"
          prrcls="print"
          prrinp="$pre.prod$post.reports.txt"
          disable="t"
        />
        <module
          name="email_outfrp_$batchid$c"
          modname="geneml01"
          emlbatt="$pre.prod$post.reports.txt"
          emlbody="See attached report"
          emlfr="\$project_manager_email"
          emlsub="$PI Order: $n Copy: $c File: $infile Completed"
          emlto="\$project_manager_email,\$programmer_email,WM_OVERFILLED_INTERNAL\\\@rrd.com,\$other_emails"
          emltto="\$programmer_email"
          disable="n"
        />		
      </process>
      <process
        name="msort_reports_process"
        disable="n"
      >
        <module
          name="concatenate_mailsort_reports_$batchid$c"
          modname="gencat01"
          catapp="n"
          catinp="$pre.attraudt.audtrpt$post.txt,$pre.code1pls.prntrpt$post.txt,$pre.msdr00.manifest$post.txt,$pre.msdr00.msrprpt$post.txt,$pre.msdr00.msrprpt2$post.txt,$pre.msdr00.msrpstm$post.txt,$pre.msdr00.msziplst$post.txt,$pre.mspstrpt.report01$post.txt"
          catout="$pre.msort$post.reports.txt"
          pre="$runpath$site$lvl.$sbu.$pi$n.$pjt"
          runpath="/bcs/$psite$lvl/clientapp/$pi$pjt/run/$rundir/"
          disable="n"
        />
        <module
          name="print_prntms_msort_reports_$batchid$c"
          modname="genprr01"
          prrcls="prntms"
          prrinp="$pre.msort$post.reports.txt"
          disable="y"
        />
        <module
          name="print_mailroom_msort_reports_$batchid$c"
          modname="genprr01"
          prrcls="mailrm"
          prrinp="$pre.mspstrpt.report1a$post.txt"
          disable="n"
        />
      </process>
	  
      <process name="label_process" disable="n">
         <module name="generate_labels" disable="n"
            modname="genlbl01"
            lblele="labels"
            lblinp="$pre.repext$post"
            lblselect="y"
            lblstart="99"
            lbllength="12"
            lblcompare="gt"
            lblvalue="000000000005"
            lblxmt="$PI$n$c.PDF"
            lblxmit="p"/>
      </process>	  
	  
	  
	  
      <process name="final_process" disable="n">
  
        <module
          name="transmit_mrdf"
          modname="genmft01"
          mftdir="$runpath"
          mftmsk="_mrdf.txt"
          disable="t"
        />
	    <command>
		  <![CDATA[
#BCFM5958000100CTCONFSMR_mrdf.txt			
			`ls ${runpath}*CAM1098_mrdf.txt >${runpath}cam$n.mrdflist.txt`;
			#`ls $Workit >${Workit}FileList.$infiledate.txt`;
			#<STDIN>;
		  ]]> 
	    </command>			
		
		
        <module
          name="cat_merge_recons"
          modname="gencat01"
          catapp="n"
          catinp="$pre.mrgrcn*"
          catout="$pre.rcncat.combined"
		  T1_catout="$pre.rcncat$post"
          disable="n"
        />
        <module
          name="reconciliation_post"
          modname="genrcn01"
          emlbhtm="wrap"
          rcnbatt="$pre.rcnrpt$post"
          rcncc1f="\$programmer_email"
          rcnele="pre_post_recon"
          rcneml="y"
		  rcnsub="Post Reconciliation Report: WasteMgmt Overfill WMI OVER $n"
          rcnfr="\$project_manager_email"
          T1_rcnin0="$pre.extrcn$copy_base"
		  T1_rcnin1="$pre.rcncat$post"
		  rcnin0="$pre.extrcn.combined"
          rcnin1="$pre.rcncat.combined"
   	      rcnin2="$pre.hhdrcn$post" 	
          rcnin3="$pre.subtracted_records"
          rcnto="\$project_manager_email,\$programmer_email,WM_OVERFILLED_INTERNAL\\\@rrd.com,WM_OVERFILLED_EXTERNAL\\\@rrd.com,\$other_emails"
          rcntto="\$project_manager_email,\$programmer_email"
		  T1_rcncc1s="client\\\@rrd.com"
          rcntyp="post"
          disable="n"
        />
        <!-- Create detailed counts report -->
        <system
            name="create_detailed_counts_report_by_file_location_type"
            command="/apps/python_3.7/bin/python3.7 ${usrscripts}create_counts_report.py $pre.repext$post $pre.recon_counts_report_$date3.csv"
            disable="y"
        />

        <module
          stepname="geneml01"
          modname="geneml01"
          emlto="\$project_manager_email,\$programmer_email,WM_OVERFILLED_INTERNAL\\\@rrd.com,WM_OVERFILLED_EXTERNAL\\\@rrd.com"
          emltto="\$project_manager_email,\$programmer_email"
          emlfr="\$programmer_email"
          emlsub="${PI}${PJT}${n} Detailed Counts Report"
          emlbody="See attached files.\n"
          emlatt="$pre.recon_counts_report_$date3.csv"
          disable="y"
        />

        <!-- Create incident report -->
        <subprocess 
        name="create_incident_report_process" 
        processname="create_incident_report_process" 
        disable="n"/>
        

        <module
          name="generd02_call"
          modname="generd02"
          erdlevel="copy"
          disable="t"
        />
        <module
          name="order_num_check"
          modname="ordernumcheck01"
          emlfr="\$programmer_email"
          emlto="\$project_manager_email,WM_OVERFILLED_INTERNAL\\\@rrd.com,\$other_emails"
          onceml="y"
          oncmax="5"
          disable="t"
        />
        <!-- SAMPLE Values! Change them if you enable this step! -->
        <assign
          name="archiving_overrides"
          arcStoreName="$PI${N}_TEST_${copy_base}_AbCd.gtar"
          arcstoredays="##"
          arcstorepath="/bcs/$psite$lvlc/archive/"
          arcstorewholedir="y"
          disable="y"
        />

        <module
          name="archive" 
          modname="genarc03" 
          arcdays="30" 
          arcstore="y" 
          arcstoredays="30" 
          disable="t" 
        />
      </process> 
	    <process 
        name="create_incident_report_process"
        disable="n"
      >
              <command step_name="incident_report_script">
	    <![CDATA[ 
            use File::Basename;
            use File::Copy;
            
            # create directory to save reports to
            my $monthly_directory = "${usrloads}/${month_long}_${oyear}";
            if (not -d $monthly_directory){
              mkdir($monthly_directory) or die("Cannot create directory ${monthly_directory} \n");
            }
            else{
              print("${monthly_directory} already exists. Not creating. \n");
            }

            #Create report
            open(FH, '>', "$pre.incident_number_report_${date3}.csv") or die $!;
            print FH "Date Processed, Zip Filename, PDF Filename, Incident # \n";

            my @zip_files = glob("${runpath}resource/*.zip");
            foreach my $my_zip (@zip_files){
                my $output = `unzip -l $my_zip`;
                my @zip_contents = split('\n',$output);
                my $zip_filename = basename($my_zip);
                
                foreach my $my_str (@zip_contents){
                    print($my_str);
                    $my_str =~/(LGN.*.pdf)/;
                    my $pdf_filename = $1;

                    if ($my_str =~ /.*INPUT([0-9]+).*.pdf/){ 
                        my $incident_num = $1;
          
                        print FH "${date8},${zip_filename},${pdf_filename},${incident_num}\n";
                    }
            }
            }
            close(FH);

            #Copy file to new directory
            copy("${pre}.incident_number_report_${date3}.csv", "${monthly_directory}");
      	    ]]>
      </command>	

      </process>

      <process 
        name="month_end_incident_report"
        disable="n"
      >
      <command name="check_end_of_month_and_create_reports"
      disable="n">
        <![CDATA[
          $dis_reporting="y";
          $value = `/apps/python_3.7/bin/python3.7 ${usrscripts}concat_incident_reports.py /bcs/lgn${lvl}/clientapp/wmiover/load/ $runpath`;
          chomp($value);
          print("$value \n");
          if ($value =~ /Final.*csv/) {
          $finalized_incident_report = $value;
          print("Found the final report${finalized_incident_report} \n");
          }
          elsif (index(${value}, "Not end of month") != -1){
            $dis_reporting="n";
          }
          else{
            die "Error thrown: ${value}\n";
          }
        ]]>
        </command>

        <module
          stepname="gendie01"
          modname="gendie01"
          dierc="0"
          diemsg="Not the end of the month"
          disable="$dis_reporting"
        />
        
        <module
          stepname="geneml01"
          modname="geneml01"
          emlto="\$project_manager_email,\$programmer_email,WM_OVERFILLED_INTERNAL\\\@rrd.com,WM_OVERFILLED_EXTERNAL\\\@rrd.com"
          emltto="\$programmer_email"
          emlfr="\$project_manager_email"
          emlsub="WMIOVER ${month_long} Incident # Report"
          emlbody="End of Month Incident Number Report.\nPlease see attached file.\n"
          emlatt="$finalized_incident_report"
          disable="n"
        />
        
      </process>


      <process
        name="reprint_process"
        disable="n"
      >
        <module
          name="pre_setup_prod_dp_$v"
          modname="genpre01"
          infile="$inreprint"
          precpy="m"
          preorg="y"
          disable="t"
        />
        <module
          name="pre_setup_test_dp_$v"
          modname="genpre01"
          infile="$inreprint"
          precpy="y"
          preorg="y"
          disable="p"
        />
        <module
          name="missing_numbers_$v"
          modname="genmis01"
          compression_level="5"
          crfsnd="n"
          epcsnd="n"
          jobtype="missing numbers"
          merge_type="print"
          misdat="$pre.repext$post"
          misget="n"
          misinp="$inwork"
          misrmd="n"
          mistpl="n"
          mistyp="auto"
		  misprr="n"
          mrgbat="${runpath}batinf.txt"
          mrgext="$matout"
          mrgimg="$pre.inimg$copy_base"
          mrgrsc="${genparms}pdf.pdf"	  
          q_freq="0"
          qrecs="0"
          T1_repmask="psnoxxxx.c$rep_c$jobid.d$v"
          repmask="pdnoxxxx.c$rep_c$jobid.d$v"
          reprint_defaults="y"
          tplpri="pro"
          disable="n"
        />
    <loop name="reorder_pages" loop_data_file="$mrglst" disable="n">
                    <module
                      name="reorder_pages"
                      modname="genreo01"
                      reoinp="$runpath$loop_curline"
                      reotyp="r"
                      reover="2"
                      disable="n"
                    />
                </loop>
        <module
          name="damage_piece_tapeless_$v"
          modname="gentpl01"
          tpllst="$mrglst"
          tplpri="pro"
          tplmov="n"
          disable="n"
        />
        <module
          name="email_dmgfrp_$v"
          modname="geneml01"
          emlatt="$pre.dmgfrp$post"
          emlbody="Reprints complete"
          emlfr="\$project_manager_email"
          emlsub="$PI Order: $n Copy: $c Batch: $batch Job: $jobid Reprints Completed"
          emlto="formsrecoverylogangroup\\\@rrd.com"
          disable="n"
        />
      </process>
    </processes>
    <printdriver
      add_font_dir="%%usrparms"
      add_image_dir="%%usrparms"
      adf_type="%%adf_type"
      break_quantity="%%chunk_qty"
      break_type="%%brk_type"
      break_unit="sysda"
      dp_bar_start="S"
      dp_bar_stop="T"
      float_address="down"
      household="%%household"

      inext="%%mrgext"
      inimg="%%extinp"
      merge_type="%%merge_type"
      mrdf_type="copy"
      outadf="%%mrgadf"
      outepc="%%mrgepc"
      outext="%%extrac"
      outfrp="%%mrgfrp"
      outhst="%%mrghst"
      outimg="%%mrgcrt"
      outlst="%%mrglst"
      outplg="%%mrgplg"
      outppr="%%mrgppr"
      outrce="%%extrcn"
      outrcm="%%mrgrcn"
      outrpt="%%mrgaud"
      outsid="%%extsid"
      outsse="%%extaud"
      outssm="%%mrgaud"
      outzrp="%%mrgzrp"
      recon_key_value="%%RECON_STEP_NAME"
      record_limit="102749999"
      recovery_files="n"
      repext="%%mrgrex"
      resadd="%%mrgrsc"
      reset_quality_info="%%reset_qual_info"
      resource="%%extres"
      standardize_orientations="3"
      work="%%extsto"
	   T1_debugging="windows"
      subext="%%mrgsub"
      hwrk="%%mrghhd"
      use_internal_tray="y"
      disable="n"
    >

    <infoshare>
      <imaging_type
        type="IPS"
        stockcode="110325"
      />
      <imaging_type
        type="XEROX-Bin1"
        stockcode="880113"
      />
    </infoshare>
    
      <file
        name="input01"
        composer="Other"
        data_type="pdf"
        dpi="300"
        T1_duplex="y"
		_duplex_input="y"
		duplex_output="y"
        escape_characters="y"
        footer="auto"
        header="auto"
		   mix_resources="n"
		   T1_quadpage="y"
        page_height="792"
        page_width="612"
		T1_file_shift_y="-10"
        _record_delimiter="text"
        xpdf_parse="y"
		T1_file_scale="95"
    add_rts_tle="y"
        disable="n"
      >

      <document 
			reference_type="char"
            reference="Doc Begin"
            reference_code="ascii"
            location="first"
            object="record"
			 window_left="500"
             window_right="560"
             window_top="0"
             window_bottom="50"
			_background_color="5"
			disposition="k"  
			T1_disposition="d"  
      disable="n"/>				

        <field
          name="DOCUMENT-KEY"
          dependent="y"
          index="1"
          length="25"
          orientation="p"
          pass="first"
		  page="first"
          reference_code="ascii"
		  T1_reference_type="offset"
		  T1_reference="Account: "
		  xoffset="9"
          variable="y"
          window_left="110"
          window_right="200"
          window_top="240"
          window_bottom="252"						
		  disposition="k"				
          disable="y"
        />	
        <field
          name="HOUSEHOLD-KEY"
          dependent="y"
          index="1"
          length="50"
          orientation="p"
          pass="first"
		  page="first"
          reference_code="ascii"
		  xoffset="9"
          variable="y"
          _window_left="99"
          window_left="55"
          window_right="432"
          window_top="256"
          window_bottom="268"				  
          disposition="k"								
          alignment="left"
          disable="n"
        />	
      <field name="NAME-ADDR"
             index="1"
             dependent="y"
             reference_code="ascii"
             window_left="55"
             window_right="400"
             window_top="139"
             window_bottom="220"
             orientation="p"
             block="6"
             break_on="y"
             page="1"
             alignment="left"
             length="50"
             variable="y"
			 disposition="d"				
			 T1_disposition="d"				
			    T1_background_color="6"
             pass="first"
             disable="n"/>	  		
      
      <field name="Account_Number"
             index="1"
             dependent="y"
				master="y"
             reference_code="ascii"
          window_left="125"
          window_right="180"
          window_top="195"
          window_bottom="205"		
             orientation="p"
             page="first"
             alignment="left"
             length="10"
             variable="y"
             disposition="k"
             pass="both"
			extract_start="2201"
			extract_length="10"			 
				background_color="7"
             disable="y"/>				 		
      </file>
      <quality
        name="quality"
        quality_frequency="%%q_freq"
        quality_image="n"
        quality_makeready="%%qrecs"
        quality_records="y"
        quality_type="alternating"
        disable="n"
      />	  
      <script>
        <extract>
          <after_document>
            <function
              name="EXTRACT"
              comment="start_mail_code"
              start="814"
              value="M"
              disable="n"
            />
            <function
              name="EXTRACT"
              comment="paper1"
              start="968"
              value="110325"
              disable="n"
            />
            <function
              _memo="Inserts handled in script right after genext01"
              name="EXTRACT"
              comment="insert1"
              start="1052"
              value="757792"
              disable="y"
            />
            <function
              _memo="Inserts handled in script right after genext01"
              name="EXTRACT"
              comment="insert_need"
              start="1124"
              value="S"
              disable="y"
            />
            <function name="EXTRACT" disable="y"
                  start="1659"
                  value="00700901081529000000"
                  comment="IMB Info"/>				

            <FUNCTION NAME="EXTRACT" 
            VARIABLE="pdf_file_name" 
            START="2201" LENGTH="100" 
            COMMENT="file name" />
          </after_document>
        </extract>
      </script>
      <!-- %%IF %%testmrdf EQ y -->
      <jobids
        name="mrdf_default_values_for_regression"
        value="0R1R2R3R4R5R6R7R8R9R"
        disable="n"
      />
      <!-- %%ENDIF -->
      <output
        name="output01"
        disable="n"
      >
        <outobject
          name="quality_banner"
          code="ascii"
          dependent="y"
          font="Helvetica"
          font_size="16"
          orientation="p"
          quality_records="only"
          sheet="all"
          side="all"
          subdoc="first"
          xoffset="200"
          yoffset="600"
          disable="n"
        >
          <segment
            format="%s"
            length="50"
            start="1"
            type="text"
            value="zzzzzzz  this is a quality record zzzzzzz"
            disable="n"
          />
        </outobject>
       <outobject_group name="Address Block"
		  yoffset="160"
          xoffset="88">
        <outobject name="control_number"
                   font="Courier"
                   font_size="8"
                   orientation="p"
                   subdoc="first"
                   sheet="first"
                   side="face"
                   code="ascii"
				   xoffset="-34"
				   yoffset="-2"				   
                   dependent="y"
                   disable="n">
          <segment type="system"
                   value="CONTROL_NUM"
                   format="%s"
                   start="1"
                   length="7"
                   disable="n"/>
        </outobject>
        <outobject name="control_line"
                   font="Helvetica"
                   font_size="6"
				   xoffset="10"
				   yoffset="0"
                   orientation="p"
                   subdoc="first"
                   sheet="first"
                   side="face"
                   code="ascii"
                   dependent="y"
                   disable="n">
          <segment type="system"
                   value="CONTROL_LINE"
                   format="%s"
                   start="8"
                   length="49"
                   disable="n"/>
          <segment type="text"
                   value=" -C%%c"
                   format="%s"
                   disable="n"/>
          <segment type="text"
                   value="-P"
                   format="%s"
                   disable="n"/>
          <segment type="system"
                   value="PIECE_ID"
                   format="%0.5i"
                   start="1"
                   length="5"
                   disable="n"/>
          <segment type="text"
                   value="-I"
                   format="%s"
                   disable="n"/>
          <segment type="system"
                   value="INSERTS"
                   format="%s"
                   start="1"
                   length="12"
                   disable="n"/>
        </outobject>
        <outobject name="imb"
                   font="IMB"
                   font_size="11"
				   xoffset="-34"
				   yoffset="10"
                   orientation="p"
                   subdoc="first"
                   sheet="first"
                   side="face"
                   code="ascii"
                   dependent="y"
                   disable="n">
          <segment type="system"
                   value="IMB_OUTPUT"
                   format="%s"
                   start="1"
                   length="65"
                   disable="n"/>
        </outobject>
        <outobject name="name_addr1"
                   font="Helvetica"
                   font_size="9"
				   xoffset="0"
				   yoffset="26"
                   orientation="p"
                   subdoc="all"
                   sheet="first"
                   side="face"
                   code="ascii"
                   dependent="y"
                   disable="n">
          <segment type="system"
                   value="NAME-ADDR"
                   index="1"
                   format="%s"
                   start="1"
                   length="50"
                   disable="n"/>
        </outobject>
        <outobject name="name_addr2"
                   font="Helvetica"
                   font_size="9"
                   xoffset="0"
                   yoffset="36"
                   orientation="p"
                   subdoc="all"
                   sheet="first"
                   side="face"
                   code="ascii"
                   dependent="y"
                   disable="n">
          <segment type="system"
                   value="NAME-ADDR"
                   index="2"
                   format="%s"
                   start="1"
                   length="50"
                   disable="n"/>
        </outobject>
        <outobject name="name_addr3"
                   font="Helvetica"
                   font_size="9"
                   xoffset="0"
                   yoffset="46"
                   orientation="p"
                   subdoc="all"
                   sheet="first"
                   side="face"
                   code="ascii"
                   dependent="y"
                   disable="n">
          <segment type="system"
                   value="NAME-ADDR"
                   index="3"
                   format="%s"
                   start="1"
                   length="50"
                   disable="n"/>
        </outobject>
        <outobject name="name_addr4"
                   font="Helvetica"
                   font_size="9"
                   xoffset="0"
                   yoffset="56"
                   orientation="p"
                   subdoc="all"
                   sheet="first"
                   side="face"
                   code="ascii"
                   dependent="y"
                   disable="n">
          <segment type="system"
                   value="NAME-ADDR"
                   index="4"
                   format="%s"
                   start="1"
                   length="50"
                   disable="n"/>
        </outobject>
        <outobject name="name_addr5"
                   font="Helvetica"
                   font_size="9"
                   xoffset="0"
                   yoffset="66"
                   orientation="p"
                   subdoc="first"
                   sheet="first"
                   side="face"
                   code="ascii"
                   dependent="y"
                   disable="y">
          <segment type="system"
                   value="NAME-ADDR"
                   index="5"
                   format="%s"
                   start="1"
                   length="50"
                   disable="n"/>
        </outobject>
        <outobject name="name_addr6"
                   font="Helvetica"
                   font_size="9"
                   xoffset="0"
                   yoffset="76"
                   orientation="p"
                   subdoc="first"
                   sheet="first"
                   side="face"
                   code="ascii"
                   dependent="y"
                   disable="y">
          <segment type="system"
                   value="NAME-ADDR"
                   index="6"
                   format="%s"
                   start="1"
                   length="50"
                   disable="n"/>
        </outobject>
        <outobject name="2D_barcode"
                   font_size="1"
                   font="8713AP"
                   xoffset="-34"
                   yoffset="28"
                   orientation="p"
                   subdoc="first"
                   sheet="first"
                   side="face"
                   code="ascii"
                   dependent="y"
                   method="draw_2d_barcode"
                   disable="n">
          <segment type="system"
                   value="MRDF2DBAR"
                   length="8"
                   format="%s"
                   start="1"
                   disable="n"/>
        </outobject>
      </outobject_group>
      <outobject name="page_control_line"
                 font="Helvetica"
                 font_size="6"
				 xoffset="72"
				 yoffset="778"
                 orientation="p"
                 subdoc="all"
                 sheet="all"
                 side="all"
                 code="ascii"
                 dependent="y"
                 disable="n">
        <segment type="text"
                 value="%%n-%%c-%%batch-"
                 format="%s"
                 disable="n"/>
        <segment type="system"
                 value="CONTROL_NUMBER"
                 format="%07.0f"
                 start="1"
                 length="7"
                 disable="n"/>
        <segment type="text"
                 value="-"
                 format="%s"
                 disable="n"/>
        <segment type="system"
                 value="DOC_SHEET"
                 format="%04.0f"
                 start="1"
                 length="4"
                 disable="n"/>
        <segment type="text"
                 value="-"
                 format="%s"
                 disable="n"/>
        <segment type="system"
                 value="RUN_SHEET_ALL"
                 format="%07.0f"
                 start="1"
                 length="7"
                 disable="n"/>
      </outobject>
      <outobject name="2D_inserter_barcode"
                 font_size="1"
                 font="8713AP"
                 xoffset="582"
                 yoffset="132"
                 orientation="p"
                 subdoc="all"
                 sheet="all"
                 side="back"
                 code="ascii"
                 dependent="y"
                 method="draw_2d_barcode"
                 disable="n">
        <segment type="system"
                 value="2DBAR_MRDFS"
                 length="9"
                 format="%s"
                 start="1"
                 disable="n"/>
      </outobject>		  
      <outobject
          name="3of9_barcode"
          code="ascii"
          dependent="y"
          font="Bar39"
          font_size="14"
          orientation="P"
          sheet="first"
          side="front"
          subdoc="all"
          xoffset="50"
          yoffset="120"
          T1_yoffset="42"		  
          disable="y"
        >
        <segment type="text"
                 value="*"
                 format="%s"
                 disable="n"/>		
          <segment type="system"
                   value="CONTROL_NUM"
                   format="%s"
                   start="1"
                   length="7"
                   disable="n"/>	
        <segment type="text"
                 value="*"
                 format="%s"
                 disable="n"/>		
				   
      </outobject>
%%IF %%solimar_validate EQ y
        <outobject name="Solimar anchor line"
                   font="C0BLANKP"
                   code_page="T1D0BASE"
                   font_size="1"
                   xoffset="18"
                   yoffset="767"
                   orientation="p"
                   subdoc="all"
                   sheet="first"
                   side="front"
                   code="ebcdic"
                   dependent="y"
                   disable="n" >
          <segment type="text"
                   value="SLMR "
                   format="%s"
                   name="segment"
                   disable="n" />
          <segment type="system"
                   value="USER_INFO"
                   index="1"
                   format="%s"
                   start="1"
                   length="10"
                   name="segment"
                   disable="n" />
        </outobject>
%%ENDIF		
<!-- ADD OUTPAGE to interject blank backer to each sheet -->
      <outpage                                
        name="Blank Backer"                 
        type="user"   
		orientation="portrait"	
		height="792"
        width="612"		
        pass="first"                           
		T1_pass="last"                           
        relationship="after"                 
        page="all"                          
        T1_subdoc="not_first"                    
        tray="tray1"                          
        disable="y"
		/>   			
	
      </output>
    </printdriver>
    <genbatch
      file_level="copy"
      file_name_case="l"
      inext="%%batinp"
      outrej="%%batrej"
      postclass="1"
      ratetype="r"
      reject_abend_percent="0"
      suppress_empty_files="y"
      thickness_factor=".92"
      disable="n"
    >
      <paper
        description="Xerox Paper2"
        stock_code="880113"
        thickness="00.46"
        weight="01.200"
        disable="n"
      />

      <paper
        description="Proteus Jet paper1"
        stock_code="110325"
        weight="01.180"
        thickness="00.500"
        disable="n"
      />
      <papergroup
        code="p"
        description="paper group1"
        paper1="110325"
        source1="tray1"
        disable="n"
      />
      <ome
        description="ome1"
        fold="z"
        stock_code="115753"
        thickness="02.43"
        usps_height="4.125"
        usps_length="9.25"
        weight="01.220"
        disable="n"
      />	  
      <ome
        description="ome2"
        fold="z"
        stock_code="999999"
        thickness="02.43"
        usps_height="4.125"
        usps_length="9.25"
        weight="01.220"
        disable="n"
      />	  
      <insert
        description="insert1"
        stock_code="757792"
        thickness="01.69"
        weight="01.200"
        priority="s"
        mail_group="1"
        suggested_feeder="01"
        feeder_type="f"
        disable="n"
      />
      <copy
        description="copy 01"
        inserter="PB08STD"
        number="01"
        paper_group="p"
        disable="n"
      />
      <copy
        description="copy 02"
        inserter="PB08STD"
        number="02"
        paper_group="p"
        disable="y"
      />	  
      <basebatch
        copy="01"
        description="basebatch1"
        mail_group="1"
        max_sheets="5"
        ome="115753"
        sets="*********"
        disable="n"
      />	  
      <basebatch
        copy="01"
        description="basebatch2"
        mail_group="9"
        max_sheets="9999"
        ome="999999"
        sets="*********"
        disable="n"
      />	  
    </genbatch>
      <genhold
        name="householding"
        inext="%%hhdinp"
        outhhd="%%hhdext"
        outhold="%%hhdimf"
        outsys="%%hhdsys"
        outrcn="%%hhdrcn"
        criteria="%%hhdcriteria"
        disable="n"
      />
    <gensort
      name="flag_proofs"
      endrec="10"
      flag_only="y"
      flag_position="125"
      flag_value="Y"
      input="%%srtinp"
      output="%%srtout"
      outsys="%%srtsys"
      record_length="3000"
      disable="n"
    />
    <GENSORT
      NAME="split_foreigns"
      INPUT="%%srtinp"
      OUTPUT="%%srtout"
      OUTSYS="%%srtsys"
      RECORD_LENGTH="3000"
      >
	 <INCLUDE START="814" LENGTH="1" COMPARE="EQ" VALUE="M" FILE="mails" />
	 <INCLUDE START="814" LENGTH="1" COMPARE="EQ" VALUE="F" FILE="foreigns" />
	 <SPLITKEY TYPE="LOGIC" FILE="mails" />
     <SPLITKEY TYPE="LOGIC" FILE="foreigns" />
    </GENSORT>  	
	
   <gensort
      name="SORT_mrdf_file"
      input="%%srtinp"
      output="%%srtout"
      outsys="%%srtsys"
      record_length="434"
	  disable="n"
	  memo="exclude  START=15 LENGTH=7 COMPARE=EQ VALUE=``````` "
      >
        <sortkey START="15" LENGTH="7" DIRECTION="ASCENDING" COMMENT="control number"/>
		<exclude START="15" LENGTH="7" COMPARE="EQ" VALUE="```````" />		
    </gensort>  	
	
	
	
	
    <genrecon
      name="pre_recon"
      batch="%%batch"
      client="%%client"
      client_code="%%client_code"
      copy="%%c"
      documents="reconcile"
      location_code="%%location_code"
      order="%%or"
      pages="report"
      project="%%project"
      project_code="%%project_code"
      report_type="%%rcntyp"
      run="%%run"
      sheets="report"
			rcninp="%%rcninp"
			rcndat="%%rcndat"
			rcnrpt="%%rcnrpt"	  
      disable="n"
    />	
    <genrecon
      name="pre_post_recon"
      batch="%%batch"
      client="%%client"
      client_code="%%client_code"
      copy="%%c"
      documents="reconcile"
      location_code="%%location_code"
      order="%%or"
      pages="reconcile"
      project="%%project"
      project_code="%%project_code"
      report_type="%%rcntyp"
      run="%%run"
      sheets="reconcile"
			rcninp="%%rcninp"
			rcndat="%%rcndat"
			rcnrpt="%%rcnrpt"	  
      disable="n"
    />	
    <information
      architecture="%%arch"
      batch_id="%%batch"
      copy_number="%%c"
      dupcheck_rerun="%%dupcheck_rerun"
      jobtype="%%jobtype"
      level="%%lvl"
      order_number="%%n"
      release="%%release"
      reprint="%%reprint"
      reprint_run="%%reprint_run"
      run_date="%%date"
      run_id="%%run"
      run_time="%%time"
      sbu="%%sbu"
      year_loc="%%yl"
      disable="n"
    />
   <genlabel name="labels" disable="n"
      inext="%%lblinp"
      outlbl="%%lblout"
      outwbs="%%wbsout"
      resadd="%%lblres"
      outpdf="%%pdfout"
      outsys="%%lblsys"
      add_image_dir="%%usrparms">
      <label name="label 1" xoffset="1"   yoffset="1"   disable="n"/>
      <label name="label 2" xoffset="1"   yoffset="267" disable="n"/>
      <label name="label 3" xoffset="1"   yoffset="532" disable="n"/>
      <label name="label 4" xoffset="310" yoffset="1"   disable="n"/>
      <label name="label 5" xoffset="310" yoffset="267" disable="n"/>
      <label name="label 6" xoffset="310" yoffset="532" disable="n"/>
      <label_object name="return_company_name" type="text" value="Waste Management" xoffset="25" yoffset="25" font="Helvetica" font_size="10" orientation="P" disable="n"/>
      <label_object name="return_company_addr1" type="text" value="2625 W Grandview Rd" xoffset="25" yoffset="35" font="Helvetica" font_size="10" orientation="P" disable="n"/>
      <label_object name="return_company_addr2" type="text" value="Phoenix, AZ  85023" xoffset="25" yoffset="45" font="Helvetica" font_size="10" orientation="P" disable="n"/>>
      <label_object name="control_number_3of9" type="text" start="26" length="7" xoffset="25" yoffset="180" font="Bar39" font_size="14" orientation="P" disable="y"/>
      <label_object name="control_number" type="text" start="26" length="7" xoffset="105" yoffset="95" font="Helvetica" font_size="8" orientation="P" disable="n"/>
      <label_object name="dash" type="text" value="-" move="n" font="Helvetica" font_size="8" orientation="P" disable="n"/>
      <label_object name="order_number" type="text" start="13" length="4" move="n" font="Helvetica" font_size="8" orientation="P" disable="n"/>
      <label_object name="dash" type="text" value="-" move="n" font="Helvetica" font_size="8" orientation="P" disable="n"/>
      <label_object name="copy_number" type="text" start="19" length="2" move="n" font="Helvetica" font_size="8" orientation="P" disable="n"/>
      <label_object name="dash" type="text" value="-" move="n" font="Helvetica" font_size="8" orientation="P" disable="n"/>
      <label_object name="batch_code" type="text" start="362" length="8" move="n" font="Helvetica" font_size="8" orientation="P" disable="n"/>
      <label_object name="ship_addr1" type="text" start="413" length="50" xoffset="105" yoffset="105" font="Helvetica" font_size="10" orientation="P" disable="n"/>
      <label_object name="ship_addr2" type="text" start="463" length="50" xoffset="105" yoffset="115" font="Helvetica" font_size="10" orientation="P" disable="n"/>
      <label_object name="ship_addr3" type="text" start="513" length="50" xoffset="105" yoffset="125" font="Helvetica" font_size="10" orientation="P" disable="n"/>
      <label_object name="ship_addr4" type="text" start="563" length="50" xoffset="105" yoffset="135" font="Helvetica" font_size="10" orientation="P" disable="n"/>
      <label_object name="ship_addr5" type="text" start="613" length="50" xoffset="105" yoffset="145" font="Helvetica" font_size="10" orientation="P" disable="y"/>
      <label_object name="logo" type="image" value="mylogo.bmp" xoffset="25" yoffset="75" font="Helvetica" font_size="10"  orientation="P" disable="y"/>
   </genlabel>	
  </powerstream>
  
